<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BDG Admin - Control Panel</title>
    <style>
        body { background: #121212; color: white; font-family: sans-serif; padding: 20px; }
        .admin-card { background: #1e1e1e; border-radius: 10px; padding: 20px; border: 1px solid #d4af37; }
        h1 { color: #d4af37; text-align: center; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border: 1px solid #333; text-align: left; }
        th { background: #d4af37; color: #1a1a1a; }
        
        .btn-update { background: #28a745; color: white; border: none; padding: 8px 12px; cursor: pointer; border-radius: 5px; }
        .btn-search { background: #d4af37; padding: 10px 20px; border: none; cursor: pointer; font-weight: bold; }
        
        input { background: #333; border: 1px solid #444; color: white; padding: 8px; border-radius: 4px; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; background: #444; }
    </style>
</head>
<body>

    <div class="admin-card">
        <h1>ðŸš€ BDG User Management</h1>
        
        <div style="margin-bottom: 20px;">
            <input type="text" id="searchPhone" placeholder="Enter Phone Number...">
            <button class="btn-search" onclick="loadUsers()">Search User</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Phone</th>
                    <th>Password</th>
                    <th>Current Balance</th>
                    <th>New Balance</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="userTableBody">
                </tbody>
        </table>
    </div>

    <script>
        // 1. Sabhi users ka data fetch karna
        async function loadUsers() {
            const phone = document.getElementById('searchPhone').value;
            try {
                // API se data mangwana
                const response = await fetch(`/api/admin/users?phone=${phone}`);
                const users = await response.json();
                
                const tableBody = document.getElementById('userTableBody');
                tableBody.innerHTML = '';

                users.forEach(user => {
                    tableBody.innerHTML += `
                        <tr>
                            <td>${user.phone}</td>
                            <td>${user.password}</td>
                            <td style="color:#d4af37; font-weight:bold;">â‚¹${user.balance.toFixed(2)}</td>
                            <td><input type="number" id="input-${user.phone}" placeholder="Add/Edit"></td>
                            <td><button class="btn-update" onclick="updateBalance('${user.phone}')">Update</button></td>
                        </tr>
                    `;
                });
            } catch (err) { console.error("Error loading users"); }
        }

        // 2. Balance update karne ka function
        async function updateBalance(phone) {
            const newBal = document.getElementById(`input-${phone}`).value;
            if(!newBal) return alert("Please enter amount");

            try {
                const res = await fetch('/api/admin/update-balance', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ phone, balance: parseFloat(newBal) })
                });
                const data = await res.json();
                if(data.success) {
                    alert("Balance Updated Successfully!");
                    loadUsers(); // Refresh data
                }
            } catch (err) { alert("Error updating balance"); }
        }

        // Page load par list dikhao
        window.onload = loadUsers;
    </script>
</body>
</html>
